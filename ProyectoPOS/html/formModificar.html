<!DOCTYPE html>
<html lang="es">

<head>
    <link rel="stylesheet" href="../css/styleformModificar.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modificación de envío</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

<body>

    <div class="principal">

        <div class="cabecera">

            <nav class="navbar navbar-custom">

                <div class="container d-flex align-items-center">
                    <!-- Imagen y marca -->
                    <a class="navbar-brand d-flex align-items-center" href="../html/index.html">
                        <img src="../img/iconoPrincipal.png" alt="Bootstrap" width="30" height="24">
                        <span class="ms-2 text-white cambiarTamano" >Pkt Express</span>
                    </a>
                    <!-- Opciones delante de la imagen -->
                    <ul class="navbar-nav flex-row gap-3">
                        <li class="nav-item">
                            <a class="nav-link text-white" href="../html/index.html#textoAcerca">Acerca de</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-white" href="../html/formRastrear.html">Rastreo</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-white" href="../html/formEnviar.html">Envío</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link text-white" href="../html/formComentario.html">Comentarios</a>
                        </li>
                    </ul>
                </div>
            </nav>

        </div>

        <div class="contenido">

            <div class="buscarEnvio">
                <br>
                <form action="" class="formularioBusquedaEnvio" id="busquedaEnvio">

                    <h2 class="lblEnvio">
                        Búsqueda de envío para editar
                    </h2><br>

                    <div class="cuadroBotonRastrear">
                        <input type="text" id="numEnvio" name="codigoRastrea" placeholder="Ingresa el número de envío"
                            required>

                        <button type="submit" class="">
                            Buscar
                        </button>
                    </div>
                </form>
                <br><br>
            </div>

            <div class="formulario">

                <form action="" id="formularioEnvio" class="formularioEnviar">

                    <h2 id="result">Detalles del envío</h2>
                    <h5>Modifique los campos necesarios</h5>

                    <p><strong>Datos de contacto</strong></p>

                    <label>Nombre del remitente -> </label>
                    <input id="nombreRemitente" type="text" placeholder="Nombre del remitente" required>
                    <br>

                    <label>Nombre del destinatario -></label>
                    <input id="nombreDestinatario" type="text" placeholder="Nombre del destinatario" required>
                    <br>

                    <label>Ciudad de origen -></label>
                    <input id="ciudadOrigen" type="text" placeholder="Ciudad de origen" required>
                    <br>

                    <label>Ciudad de destino -></label>
                    <input id="ciudadDestino" type="text" placeholder="Ciudad de destino" required>
                    <br>

                    <p><strong>Datos del paquete </strong></p>
                    <label>Peso del paquete en Kg -></label>
                    <input id="peso" type="number" placeholder="Peso del paquete en Kg" min="1" max="50" required>
                    <br>

                    <label>Ancho del paquete en cm -></label>
                    <input id="ancho" type="number" placeholder="Ancho del paquete en cm" min="1" max="200" required>
                    <br>

                    <label>Largo del paquete en cm -></label>
                    <input id="largo" type="number" placeholder="Largo del paquete en cm" min="1" max="200" required>
                    <br>

                    <label>Alto del paquete en cm -></label>
                    <input id="alto" type="number" placeholder="Alto del paquete en cm" min="1" max="200" required>
                    <br>
                    <br>
                    <div class="botonCentrar">
                        <button class="botonEnviar" disabled type="submit" id="botonEnviar12">Editar</button>
                    </div>
                    <br><br>
                </form>

            </div>

        </div>

        <div class="piePagina">

            <div class="uno">
                <p>Av San Pablo Xalpa 180, San Martin Xochinahuac, Azcapotzalco, 02128 Ciudad de México, CDMX</p>
                <p>55 5318 9000</p>
                <p>Términos y condiciones</p>
            </div>


            <div class="dos">
                <p>Aviso de privacidad</p>
                <p>Uso de cookies</p>
            </div>


            <div class="tres">
                <p>Siguenos</p>
                <img src="../img/iconosRedes.PNG" alt="">
            </div>


        </div>

    </div>

    <script>
        const form = document.getElementById('busquedaEnvio');
        const result = document.getElementById('result');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const id = document.getElementById('numEnvio').value;

            try {
                const response = await fetch(`http://localhost:3000/consultarEnvios${id}`);

                const data = await response.json();

                if (response.ok) {
                    for (const key in data) {
                        const inputElement = document.getElementById(key); // Busca el input por su id
                        if (inputElement) {
                            inputElement.value = data[key]; // Asigna el valor correspondiente
                        }
                    }
                    const boton = document.getElementById("botonEnviar12");
                    boton.disabled = false
                } else {
                    result.textContent = `ERROR:  ${data.error}`;
                }
            } catch (error) {
                result.textContent = 'Que triste, paso algo al realizar la conexión.';
                console.error(error);
            }
        });

        const formulario = document.getElementById('formularioEnvio');

        formulario.addEventListener('submit', async (e) => {
            e.preventDefault();

            const id = document.getElementById('numEnvio').value; // El ID del envío
            const datosEnvio = {
                nombreRemitente: document.getElementById('nombreRemitente').value,
                nombreDestinatario: document.getElementById('nombreDestinatario').value,
                ciudadOrigen: document.getElementById('ciudadOrigen').value,
                ciudadDestino: document.getElementById('ciudadDestino').value,
                peso: document.getElementById('peso').value,
                ancho: document.getElementById('ancho').value,
                largo: document.getElementById('largo').value,
                alto: document.getElementById('alto').value
            };

            try {
                const response = await fetch(`http://localhost:3000/actualizarEnvio${id}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json',},
                    body: JSON.stringify(datosEnvio)
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Envío actualizado correctamente');
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                alert('Error al conectar con el servidor');
                console.error(error);
            }
        });

    </script>

</body>

</html>